<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>reporteros2_unidad5_leccion2_condicional</title>
<style>
  :root{--bg:#f8fafc;--card:#ffffff;--ink:#0f172a;--muted:#475569;--accent:#0ea5e9;--ok:#16a34a;--bad:#dc2626;--chip:#e2e8f0}
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Helvetica,Arial,sans-serif;line-height:1.45}
  header{padding:14px;background:linear-gradient(90deg,#0ea5e9,#22c55e);color:#fff;display:flex;flex-wrap:wrap;align-items:center;gap:10px}
  header .brand{font-weight:900;background:rgba(255,255,255,.18);padding:4px 10px;border-radius:999px}
  header h1{margin:0;font-size:1.06rem}
  .wrap{max-width:1100px;margin:18px auto;padding:0 12px 64px}
  .card{background:var(--card);border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 6px 20px rgba(2,6,23,.06);padding:16px;margin:12px 0}
  .dir{font-size:.95rem;color:var(--muted);border-left:4px solid var(--accent);padding-left:10px;margin:6px 0}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .pill{display:inline-block;background:#e2e8f0;border-radius:999px;padding:.2rem .6rem;font-size:.8rem}
  .kbd{font-family:ui-monospace, Menlo, Consolas, monospace;background:#f1f5f9;border:1px solid #e2e8f0;border-bottom-width:3px;padding:2px 6px;border-radius:6px}
  .small{font-size:.92rem;color:var(--muted)}
  .primary{background:#0ea5e9;color:#fff;border:0;border-radius:10px;padding:9px 12px;font-weight:800;cursor:pointer}
  .ghost{background:#eef2ff;border:1px solid #c7d2fe;color:#111827;border-radius:10px;padding:8px 10px;font-weight:700;cursor:pointer}
  .q{border:1px solid #e5e7eb;border-radius:12px;padding:10px;margin-top:8px}
  .q.correct{border-color:#86efac;background:#f0fdf4}
  .q.incorrect{border-color:#fecaca;background:#fff7f7}
  .feedback{margin-top:6px;font-size:.95rem;min-height:1.2em}
  .good{color:#065f46}.bad{color:#b91c1c}
  .grid2{display:grid;grid-template-columns:1fr;gap:10px}
  .grid3{display:grid;grid-template-columns:1fr;gap:10px}
  @media(min-width:900px){ .grid2{grid-template-columns:1fr 1fr} .grid3{grid-template-columns:1fr 1fr 1fr} }
  input[type="text"], select{padding:8px;border:1px solid #cbd5e1;border-radius:10px}
  .chips{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
  .chip{background:var(--chip);padding:6px 10px;border-radius:999px;font-weight:700;cursor:grab;user-select:none;border:1px solid #cbd5e1}
  .chip.sel{outline:3px solid #2563eb}
  .drop{min-height:48px;padding:8px;border:2px dashed #cbd5e1;border-radius:10px;background:#f8fafc;margin:6px 0;display:flex;gap:8px;flex-wrap:wrap}
  .slot{min-width:60px;min-height:36px;display:inline-flex;align-items:center;justify-content:center;background:#eef2ff;border:1px dashed #c7d2fe;border-radius:8px;padding:4px 8px;margin:0 4px}
  .slot.error{background:#fff1f2;border-color:#fecdd3}
  .slot.ok{background:#ecfdf5;border-color:#86efac}
  .key{display:none;margin-top:6px;font-size:.9rem;color:#2563eb}
  .fade-out{animation: fade .6s ease forwards}
  @keyframes fade{from{opacity:1}to{opacity:0}}
</style>
</head>
<body>
<header>
  <span class="brand">ProfeVT</span>
  <h1>reporteros2_unidad5_leccion2 ‚Äî El condicional</h1>
  <div style="margin-left:auto"><span class="small">Nombre / Name: <input id="studentName" placeholder="Tu nombre‚Ä¶" style="max-width:220px"></span></div>
</header>

<div class="wrap">

  <!-- Goals & ACTFL -->
  <section class="card">
    <h2 style="margin:.2rem 0 .6rem">Objetivos & ACTFL</h2>
    <p class="dir"><b>I can</b> (EN): talk about hypothetical situations and future possibilities using the <b>conditional</b> (I would help, they would build), and combine it with <b>si</b> clauses (If we had‚Ä¶, we would‚Ä¶).</p>
    <p class="dir"><b>Yo puedo</b> (ES): expresar hip√≥tesis y ofrecer opciones con el <b>condicional</b> y con <b>si</b> + imperfecto del subjuntivo.</p>
    <p class="small"><b>Standards:</b> ACTFL 1.1, 1.2, 2.1, 3.1, 4.1, 5.1.</p>
    <details class="small">
      <summary>Mini-gu√≠a</summary>
      <p><b>Condicional regular:</b> infinitivo + <span class="kbd">-√≠a, -√≠as, -√≠a, -√≠amos, -√≠ais, -√≠an</span>. Ej.: <i>ahorrar</i> ‚Üí <i>ahorrar√≠a</i>.</p>
      <p><b>Irregulares (ra√≠z):</b> <i>tener‚Üítendr-, poner‚Üípondr-, poder‚Üípodr-, decir‚Üídir-, hacer‚Üíhar-, querer‚Üíquerr-, saber‚Üísabr-, salir‚Üísaldr-, venir‚Üívendr-, haber‚Üíhabr-</i>.</p>
      <p><b>Estructura:</b> <span class="kbd">Si + imperfecto del subjuntivo</span>, <span class="kbd">condicional</span>. Ej.: <i>Si tuvi√©ramos paneles solares, pagar√≠amos menos</i>.</p>
      <p><b>Conectores:</b> <i>a lo mejor / quiz√°</i> + presente para posibilidad; condicional para cortes√≠a: <i>¬øPodr√≠as ayudar?</i></p>
    </details>
    <div class="row">
      <span class="pill">Tiempo: <span id="timeOnPage">0s</span></span>
      <span class="pill">Fuera de pesta√±a: <span id="tabAway">0s</span></span>
      <button class="ghost" id="showTips">üí° Consejos</button>
    </div>
    <div class="key" id="tips">
      Usa vocabulario de medioambiente y ocupaciones para dar <i>soluciones hipot√©ticas</i>. Ej.: Un <b>ingeniero</b> <i>dise√±ar√≠a</i> paneles solares para <i>proteger</i> el ecosistema.
    </div>
  </section>

  <!-- Activity 1: Vocab mini-match -->
  <section class="card" id="a1">
    <h3>Actividad 1 ‚Äî Vocabulario r√°pido (arrastrar o clic‚Üícolocar)</h3>
    <p class="dir">ES: Une cada t√©rmino con su definici√≥n. EN: Match each term with its definition. <span class="pill">Arrastra <b>o</b> haz clic en ficha y luego en el cuadro.</span></p>
    <div class="grid2">
      <div><div class="chips" id="a1Bank"></div></div>
      <div>
        <div class="q" data-i="0">1) <span class="small">to save water/energy</span> ‚Üí <span class="slot" data-target="ahorrar"> </span></div>
        <div class="q" data-i="1">2) <span class="small">to endanger</span> ‚Üí <span class="slot" data-target="poner en peligro"> </span></div>
        <div class="q" data-i="2">3) <span class="small">self-driving vehicle</span> ‚Üí <span class="slot" data-target="veh√≠culo aut√≥nomo"> </span></div>
        <div class="q" data-i="3">4) <span class="small">renewable energy source</span> ‚Üí <span class="slot" data-target="fuente de energ√≠a renovable"> </span></div>
        <div class="q" data-i="4">5) <span class="small">to fight for / against</span> ‚Üí <span class="slot" data-target="luchar por / luchar contra"> </span></div>
        <div class="q" data-i="5">6) <span class="small">3D printer</span> ‚Üí <span class="slot" data-target="impresora 3D"> </span></div>
        <div class="q" data-i="6">7) <span class="small">environment</span> ‚Üí <span class="slot" data-target="medioambiente"> </span></div>
        <div class="q" data-i="7">8) <span class="small">nurse</span> ‚Üí <span class="slot" data-target="enfermero/a"> </span></div>
        <div class="q" data-i="8">9) <span class="small">engineer</span> ‚Üí <span class="slot" data-target="ingeniero/a"> </span></div>
        <div class="q" data-i="9">10) <span class="small">supportive</span> ‚Üí <span class="slot" data-target="solidario/a"> </span></div>
      </div>
    </div>
    <div class="feedback" id="a1Fb"></div>
    <div class="row" style="justify-content:flex-end">
      <button class="ghost" id="a1Reset">Reiniciar</button>
      <button class="primary" id="a1Check">Comprobar</button>
    </div>
    <div class="pill" id="a1Score">Correctos: 0 / 10</div>
  </section>

  <!-- Activity 2: Conjugation -->
  <section class="card" id="a2">
    <h3>Actividad 2 ‚Äî Conjuga en <u>condicional</u></h3>
    <p class="dir">ES: Escribe la forma correcta. Muestra la soluci√≥n 3s si fallas. EN: Type the correct conditional form. Shows solution 3s on error.</p>
    <div class="grid3" id="a2Grid"></div>
    <div class="row" style="justify-content:flex-end">
      <button class="ghost" id="a2Reset">Reiniciar</button>
      <button class="primary" id="a2Check">Comprobar</button>
    </div>
    <div class="pill" id="a2Score">Correctos: 0 / 12</div>
  </section>

  <!-- Activity 3: Si + imp. subj , condicional -->
  <section class="card" id="a3">
    <h3>Actividad 3 ‚Äî <span class="kbd">Si + imp. subj.</span>, <span class="kbd">condicional</span></h3>
    <p class="dir">ES: Elige las dos formas correctas. EN: Choose both correct forms.</p>
    <div id="a3List"></div>
    <div class="row" style="justify-content:flex-end;margin-top:8px">
      <button class="ghost" id="a3Reset">Reiniciar</button>
      <button class="primary" id="a3Check">Comprobar</button>
    </div>
    <div class="pill" id="a3Score">Correctos: 0 / 8</div>
  </section>

  <!-- Activity 4: Guided sentence build -->
  <section class="card" id="a4">
    <h3>Actividad 4 ‚Äî Construye la frase (cortes√≠a / hip√≥tesis)</h3>
    <p class="dir">ES: Selecciona o arrastra fichas para formar una oraci√≥n l√≥gica. EN: Click or drag chips to build a logical sentence.</p>
    <div class="q">
      <div class="chips" id="a4Bank"></div>
      <div class="drop" id="a4Drop"></div>
      <div class="feedback" id="a4Fb"></div>
      <div class="row" style="justify-content:flex-end">
        <button class="ghost" id="a4Reset">Reiniciar</button>
        <button class="primary" id="a4Check">Comprobar</button>
      </div>
      <div class="pill" id="a4Score">Correctos: 0 / 5</div>
      <div class="key" id="a4Key"></div>
    </div>
  </section>

  <!-- Activity 5: Error hunt -->
  <section class="card" id="a5">
    <h3>Actividad 5 ‚Äî Caza-errores</h3>
    <p class="dir">ES: En cada oraci√≥n hay un error en el condicional. Haz clic en la palabra incorrecta. EN: Click the wrong word.</p>
    <div id="a5Items"></div>
    <div class="row" style="justify-content:flex-end;margin-top:8px">
      <button class="ghost" id="a5Reset">Reiniciar</button>
      <button class="primary" id="a5Check">Comprobar</button>
    </div>
    <div class="pill" id="a5Score">Correctos: 0 / 6</div>
  </section>

  <!-- Report -->
  <section class="card">
    <h2>Informe / Report (.txt)</h2>
    <pre id="reportPreview">‚Äî Pulsa ‚ÄúActualizar vista previa‚Äù ‚Äî</pre>
    <div class="row" style="justify-content:flex-end">
      <button class="ghost" id="previewBtn">Actualizar vista previa</button>
      <button class="ghost" id="copyBtn">Copiar</button>
      <button class="primary" id="downloadReport">Descargar (.txt)</button>
    </div>
  </section>

</div>

<script>
/* ===== Timing ===== */
let pageStart=performance.now(), timeAwayTotal=0, lastHidden=null;
document.addEventListener('visibilitychange', ()=>{
  if(document.hidden){ lastHidden=performance.now(); }
  else if(lastHidden){ timeAwayTotal += performance.now()-lastHidden; lastHidden=null; }
});
setInterval(()=>{
  const s=Math.round((performance.now()-pageStart)/1000);
  document.getElementById('timeOnPage').textContent=s+'s';
  document.getElementById('tabAway').textContent=Math.round(timeAwayTotal/1000)+'s';
},500);
document.getElementById('showTips').addEventListener('click',()=>{
  const t=document.getElementById('tips'); t.style.display='block'; setTimeout(()=>{ t.style.display='none'; }, 9000);
});

/* ===== Helpers ===== */
function stripAccents(s){ return s.normalize('NFD').replace(/[\u0300-\u036f]/g,''); }
function norm(s){ return stripAccents(String(s||'').trim().toLowerCase().replace(/\s+/g,' ')); }
function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function shuffle(a){ const x=a.slice(); for(let i=x.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [x[i],x[j]]=[x[j],x[i]]; } return x; }

/* ===== Scoring ===== */
let totalChecks=0;
const INC={a1:0,a2:0,a3:0,a4:0,a5:0};
const CORR={a1:0,a2:0,a3:0,a4:0,a5:0};
const TOTAL={a1:0,a2:0,a3:0,a4:0,a5:0};

/* ===== Activity 1: Vocab chips ===== */
const A1_TERMS = [
  "ahorrar","poner en peligro","veh√≠culo aut√≥nomo","fuente de energ√≠a renovable","luchar por / luchar contra","impresora 3D","medioambiente","enfermero/a","ingeniero/a","solidario/a"
];
function buildA1(){
  const bank=document.getElementById('a1Bank'); bank.innerHTML='';
  shuffle(A1_TERMS).forEach(t=>{
    const s=document.createElement('span'); s.className='chip'; s.textContent=t; s.draggable=true;
    s.addEventListener('dragstart',e=>{ e.dataTransfer.setData('text/plain', t); s.classList.add('sel'); });
    s.addEventListener('dragend',()=> s.classList.remove('sel'));
    s.addEventListener('click',()=>{ document.querySelectorAll('#a1 .chip').forEach(c=>c.classList.remove('sel')); s.classList.add('sel'); });
    bank.appendChild(s);
  });
  document.querySelectorAll('#a1 .slot').forEach(slot=>{
    slot.innerHTML='';
    slot.addEventListener('dragover',e=>e.preventDefault());
    slot.addEventListener('drop',e=>{ e.preventDefault(); const txt=e.dataTransfer.getData('text/plain'); placeChip(slot, txt); });
    slot.addEventListener('click',()=>{ const sel=document.querySelector('#a1 .chip.sel'); if(sel){ placeChip(slot, sel.textContent); }});
  });
  document.getElementById('a1Fb').textContent='';
}
function placeChip(slot, txt){
  slot.textContent='';
  const chip=document.createElement('span'); chip.className='chip'; chip.textContent=txt;
  chip.addEventListener('click',()=>{ chip.remove(); const bank=document.getElementById('a1Bank'); const c=document.createElement('span'); c.className='chip'; c.textContent=txt; c.addEventListener('click',()=>{ document.querySelectorAll('#a1 .chip').forEach(x=>x.classList.remove('sel')); c.classList.add('sel'); }); bank.appendChild(c); });
  slot.appendChild(chip);
}
document.getElementById('a1Check').addEventListener('click',()=>{
  TOTAL.a1++; totalChecks++;
  let score=0;
  document.querySelectorAll('#a1 .q').forEach(q=>{
    const slot=q.querySelector('.slot'); const target=slot.dataset.target;
    const got=(slot.textContent||'').trim();
    if(norm(got)===norm(target)){ q.classList.add('correct'); q.classList.remove('incorrect'); score++; slot.classList.add('ok'); slot.classList.remove('error'); }
    else { q.classList.add('incorrect'); q.classList.remove('correct'); slot.classList.add('error'); slot.classList.remove('ok'); }
  });
  CORR.a1 = score; INC.a1 = (10-score);
  document.getElementById('a1Score').textContent = `Correctos: ${score} / 10`;
  const fb = document.getElementById('a1Fb');
  if(score===10){ fb.innerHTML='<span class="good">‚úÖ ¬°Perfecto!</span>'; } else { fb.innerHTML='<span class="bad">Revisa los cuadros en rojo. Haz clic en una ficha dentro de un cuadro para devolverla al banco.</span>'; }
});
document.getElementById('a1Reset').addEventListener('click', buildA1);

/* ===== Activity 2: Conjugation ===== */
const A2_ITEMS = [
  ['yo','ahorrar','ahorrar√≠a'],['t√∫','proteger','proteger√≠as'],['√©l/ella/usted','construir','construir√≠a'],
  ['nosotros','cuidar','cuidar√≠amos'],['vosotros','protestar','protestar√≠ais'],['ellos/ellas/ustedes','limpiar','limpiar√≠an'],
  ['yo','tener','tendr√≠a'],['t√∫','hacer','har√≠as'],['√©l/ella/usted','poder','podr√≠a'],
  ['nosotros','decir','dir√≠amos'],['vosotros','querer','querr√≠ais'],['ellos/ellas/ustedes','venir','vendr√≠an']
];
function buildA2(){
  const c=document.getElementById('a2Grid'); c.innerHTML='';
  shuffle(A2_ITEMS).forEach((it,i)=>{
    const [subj,verb,ans]=it;
    const card=document.createElement('div'); card.className='q'; card.dataset.ans=ans;
    card.innerHTML = `<div><b>${subj}</b> ‚Üí <i>${verb}</i></div>
      <input type="text" class="a2in" placeholder="forma en condicional..." style="width:100%;margin-top:6px">
      <div class="feedback small"></div>`;
    c.appendChild(card);
  });
}
document.getElementById('a2Check').addEventListener('click',()=>{
  TOTAL.a2++; totalChecks++;
  let got=0;
  document.querySelectorAll('#a2Grid .q').forEach(q=>{
    const inp=q.querySelector('.a2in'); const fb=q.querySelector('.feedback');
    const ans=q.dataset.ans;
    if(norm(inp.value)===norm(ans)){ q.classList.add('correct'); q.classList.remove('incorrect'); fb.innerHTML='<span class="good">‚úÖ</span>'; got++; }
    else{
      q.classList.add('incorrect'); q.classList.remove('correct');
      fb.innerHTML = `<span class="bad">‚Üí ${ans}</span>`;
      setTimeout(()=>{ fb.classList.add('fade-out'); setTimeout(()=>{ fb.classList.remove('fade-out'); fb.textContent=''; }, 650); }, 3000);
      inp.value=''; inp.focus();
    }
  });
  CORR.a2=got; INC.a2=(12-got);
  document.getElementById('a2Score').textContent = `Correctos: ${got} / 12`;
});
document.getElementById('a2Reset').addEventListener('click', buildA2);

/* ===== Activity 3: Si-clause dropdowns ===== */
const A3_ITEMS = [
  { si:['tuvi√©ramos','tendr√≠amos','tenemos'], main:['ahorrar√≠amos','ahorramos','ahorrar√≠amos'], prompt:'Si nosotros (tener) paneles solares, (ahorrar) dinero.' , correct:['tuvi√©ramos','ahorrar√≠amos']},
  { si:['fuera','ser√≠a','somos'], main:['pagar√≠a','pagar√°','pagamos'], prompt:'Si la electricidad (ser) m√°s barata, la gente (pagar) menos.', correct:['fuera','pagar√≠a']},
  { si:['pudi√©ramos','podr√≠amos','podemos'], main:['construir√≠amos','construimos','construiremos'], prompt:'Si (poder) reciclar m√°s, (construir) menos vertederos.', correct:['pudi√©ramos','construir√≠amos']},
  { si:['hubiera','habr√≠a','hay'], main:['proteger√≠amos','protegemos','protegeremos'], prompt:'Si (haber) m√°s √°rboles, (proteger) el ecosistema.', correct:['hubiera','proteger√≠amos']},
  { si:['supi√©ramos','sabemos','sabr√≠amos'], main:['informar√≠amos','informamos','informaremos'], prompt:'Si (saber) m√°s sobre el medioambiente, (informar) a todos.', correct:['supi√©ramos','informar√≠amos']},
  { si:['pudieran','podr√≠an','pueden'], main:['limitar√≠an','limitan','limitar√°n'], prompt:'Si ellos (poder) usar paneles, (limitar) la contaminaci√≥n.', correct:['pudieran','limitar√≠an']},
  { si:['tuvieras','tendr√≠as','tienes'], main:['ayudar√≠as','ayudas','ayudar√°s'], prompt:'Si t√∫ (tener) tiempo, ¬ø(ayudar) como voluntario?', correct:['tuvieras','ayudar√≠as']},
  { si:['protestaran','protestar√≠an','protestan'], main:['cambiar√≠an','cambian','cambiar√°n'], prompt:'Si los ciudadanos (protestar), el gobierno (cambiar).', correct:['protestaran','cambiar√≠an']}
];
function buildA3(){
  const c=document.getElementById('a3List'); c.innerHTML='';
  A3_ITEMS.forEach((it,idx)=>{
    const row=document.createElement('div'); row.className='q';
    row.innerHTML = `<div>${idx+1}) ${it.prompt}</div>
      <div class="small" style="margin:6px 0">
        Si <select class="a3si">${it.si.map(x=>`<option>${x}</option>`).join('')}</select> ‚Ä¶ , ‚Ä¶ <select class="a3main">${it.main.map(x=>`<option>${x}</option>`).join('')}</select>
      </div>
      <div class="feedback small"></div>`;
    c.appendChild(row);
  });
}
document.getElementById('a3Check').addEventListener('click',()=>{
  TOTAL.a3++; totalChecks++;
  let score=0;
  document.querySelectorAll('#a3List .q').forEach((row,i)=>{
    const si=row.querySelector('.a3si').value;
    const main=row.querySelector('.a3main').value;
    const fb=row.querySelector('.feedback');
    const ok = (si===A3_ITEMS[i].correct[0] && main===A3_ITEMS[i].correct[1]);
    if(ok){ score++; row.classList.add('correct'); row.classList.remove('incorrect'); fb.innerHTML='<span class="good">‚úÖ</span>'; }
    else{ row.classList.add('incorrect'); row.classList.remove('correct'); fb.innerHTML='<span class="bad">‚Üí '+A3_ITEMS[i].correct.join(' , ')+'</span>'; setTimeout(()=>{ fb.textContent=''; }, 3000); }
  });
  CORR.a3=score; INC.a3=(A3_ITEMS.length-score);
  document.getElementById('a3Score').textContent = `Correctos: ${score} / ${A3_ITEMS.length}`;
});
document.getElementById('a3Reset').addEventListener('click', buildA3);

/* ===== Activity 4: Guided build ===== */
const A4_MODELS = [
  ["¬øPodr√≠as","explicarme","el plan","de energ√≠a","renovable?"],
  ["Construir√≠amos","m√°s","parques","si","tuvi√©ramos","dinero."],
  ["Los","ingenieros","dise√±ar√≠an","veh√≠culos","aut√≥nomos","sostenibles."],
  ["Yo","ahorrar√≠a","electricidad","con","paneles","solares."],
  ["Ellos","proteger√≠an","el","medioambiente","en","la","ciudad."]
];
function buildA4(){
  const bank=document.getElementById('a4Bank'); const drop=document.getElementById('a4Drop'); const key=document.getElementById('a4Key');
  bank.innerHTML=''; drop.innerHTML=''; document.getElementById('a4Fb').textContent='';
  const model = pick(A4_MODELS); key.textContent='Modelo: '+model.join(' ');
  shuffle(model).forEach(word=>{
    const chip=document.createElement('span'); chip.className='chip'; chip.textContent=word; chip.draggable=true;
    chip.addEventListener('dragstart',e=>{ e.dataTransfer.setData('text/plain', word); chip.classList.add('sel'); });
    chip.addEventListener('dragend',()=> chip.classList.remove('sel'));
    chip.addEventListener('click',()=>{ document.querySelectorAll('#a4 .chip').forEach(c=>c.classList.remove('sel')); chip.classList.add('sel'); });
    bank.appendChild(chip);
  });
  drop.addEventListener('dragover',e=>e.preventDefault());
  drop.addEventListener('drop',e=>{ e.preventDefault(); const w=e.dataTransfer.getData('text/plain'); addToDrop(w); });
  drop.addEventListener('click',()=>{ const sel=document.querySelector('#a4 .chip.sel'); if(sel){ addToDrop(sel.textContent); }});
  function addToDrop(word){
    const chip=document.createElement('span'); chip.className='chip'; chip.textContent=word;
    chip.addEventListener('click',()=>chip.remove());
    drop.appendChild(chip);
  }
}
document.getElementById('a4Check').addEventListener('click',()=>{
  TOTAL.a4++; totalChecks++;
  const target=document.getElementById('a4Key').textContent.replace('Modelo: ','').trim();
  const got=Array.from(document.querySelectorAll('#a4Drop .chip')).map(c=>c.textContent).join(' ').trim();
  const fb=document.getElementById('a4Fb'); 
  if(norm(got)===norm(target)){ CORR.a4++; document.querySelector('#a4 .q').classList.add('correct'); document.querySelector('#a4 .q').classList.remove('incorrect'); fb.innerHTML='<span class="good">‚úÖ Correcto</span>'; buildA4(); }
  else { INC.a4++; document.querySelector('#a4 .q').classList.add('incorrect'); document.querySelector('#a4 .q').classList.remove('correct'); fb.innerHTML='<span class="bad">‚Üí '+target+'</span>'; setTimeout(()=>{ fb.textContent=''; }, 3000); }
  document.getElementById('a4Score').textContent = `Correctos: ${CORR.a4} / 5`;
});
document.getElementById('a4Reset').addEventListener('click', buildA4);

/* ===== Activity 5: Error hunt ===== */
const A5_ITEMS = [
  {sent:"Yo ahorrar√≠as electricidad para ayudar al planeta.", bad:"ahorrar√≠as", fix:"ahorrar√≠a"},
  {sent:"Ellos construir√≠a parques si tuvieran dinero.", bad:"construir√≠a", fix:"construir√≠an"},
  {sent:"Nosotros podr√≠as reciclar m√°s con nuevas normas.", bad:"podr√≠as", fix:"podr√≠amos"},
  {sent:"T√∫ proteger√≠an el bosque con m√°s voluntarios.", bad:"proteger√≠an", fix:"proteger√≠as"},
  {sent:"La ciudad pagar√≠amos menos con energ√≠a solar.", bad:"pagar√≠amos", fix:"pagar√≠a"},
  {sent:"Los ingenieros dir√≠as que es sostenible.", bad:"dir√≠as", fix:"dir√≠an"}
];
function buildA5(){
  const c=document.getElementById('a5Items'); c.innerHTML='';
  A5_ITEMS.forEach((it,idx)=>{
    const div=document.createElement('div'); div.className='q';
    div.innerHTML=`${idx+1}) ${it.sent.replace(it.bad, '<span class="chip" data-bad="1">'+it.bad+'</span>')}
      <div class="feedback small"></div>`;
    c.appendChild(div);
  });
}
document.getElementById('a5Check').addEventListener('click',()=>{
  TOTAL.a5++; totalChecks++;
  let score=0;
  document.querySelectorAll('#a5Items .q').forEach((row,i)=>{
    const clicked = row.querySelector('[data-bad].clicked');
    const fb=row.querySelector('.feedback');
    if(clicked){ score++; row.classList.add('correct'); row.classList.remove('incorrect'); fb.innerHTML='<span class="good">‚úÖ '+A5_ITEMS[i].fix+'</span>'; }
    else{ row.classList.add('incorrect'); row.classList.remove('correct'); fb.innerHTML='<span class="bad">‚Üí '+A5_ITEMS[i].fix+'</span>'; setTimeout(()=>{ fb.textContent=''; }, 3000); }
  });
  CORR.a5=score; INC.a5=(A5_ITEMS.length-score);
  document.getElementById('a5Score').textContent = `Correctos: ${CORR.a5} / ${A5_ITEMS.length}`;
});
document.getElementById('a5Reset').addEventListener('click', buildA5);
document.getElementById('a5').addEventListener('click', (e)=>{
  const t=e.target;
  if(t.dataset && t.dataset.bad==='1'){ t.classList.toggle('clicked'); }
});

/* ===== Report ===== */
function pad2(n){ return n<10?'0'+n:n; }
function formatSeconds(s){ const m=Math.floor(s/60), r=s%60; return m+':'+pad2(r); }
function buildReport(){
  const name=(document.getElementById('studentName').value||'SinNombre').trim();
  const secs=Math.round((performance.now()-pageStart)/1000);
  return [
    'Student: '+name,
    'Time in activity: '+formatSeconds(secs),
    'Total checks: '+totalChecks,
    'Incorrect A1 (vocab match): '+INC.a1,
    'Incorrect A2 (conjugation): '+INC.a2,
    'Incorrect A3 (si + condicional): '+INC.a3,
    'Incorrect A4 (build sentence): '+INC.a4,
    'Incorrect A5 (error hunt): '+INC.a5,
    'Tab-away seconds: '+Math.round(timeAwayTotal/1000)
  ].join('\r\n');
}
function refreshReport(){ document.getElementById('reportPreview').textContent=buildReport(); }
function copyReport(){
  const t=buildReport();
  if(navigator.clipboard&&navigator.clipboard.writeText){ navigator.clipboard.writeText(t); alert('Copied'); }
  else { const ta=document.createElement('textarea'); ta.value=t; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); alert('Copied'); }
}
function downloadReport(){
  const name=(document.getElementById('studentName').value||'report').replace(/[^\w\s√Å√â√ç√ì√ö√ú√ë√°√©√≠√≥√∫√º√±.-]/g,'');
  const blob=new Blob([buildReport()],{type:'text/plain;charset=utf-8'});
  const url=URL.createObjectURL(blob); const a=document.createElement('a');
  a.href=url; a.download=(name||'report')+'_condicional.txt';
  document.body.appendChild(a); a.click(); setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); },0);
}
document.getElementById('previewBtn').addEventListener('click', refreshReport);
document.getElementById('copyBtn').addEventListener('click', copyReport);
document.getElementById('downloadReport').addEventListener('click', downloadReport);

/* ===== Init ===== */
function initAll(){ buildA1(); buildA2(); buildA3(); buildA4(); buildA5(); }
initAll();
</script>
</body>
</html>
